### 프로젝트명: 한줄 일기장

팀원 수: 1명<br>
개발 기간: 2주<br>

사용 언어: Kotlin<br>
사용 SDK: Android SDK
사용 라이브러리: MPAndroidChart<br>
사용 툴: Android Studio 3.2<br>

### 프로그램 설명(동일)
<img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM3.png"><img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM6.png"><img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM9.png">
- 날씨와 기분을 같이 기록하는 메모장
- 작성한 모든 메모를 작성 날짜 순으로 정렬<br>
특정 기간에 작성한 메모만 확인 가능
- 날씨와 기분을 통계로 확인 가능<br>
통계를 원하는 기간의 설정도 가능
- (추가)Kotlin 언어를 배우기 위해 기존 프로젝트를 해당 언어로 작성
	
### 동작 과정(동일)
- 메모 추가
  1. 메인 화면의 연필 아이콘을 눌러 메모 작성/수정 화면으로 이동한다.
  2. 상단의 날씨, 기분을 지정하고 메모 내역을 작성한다.
  3. 추가 버튼을 누르면 DB에 추가되고, 이후 메인 화면에서 확인이 가능
- 메모 수정
  1. 메인 화면에서 수정을 원하는 메모를 눌러 나오는 다이얼로그에서 수정을 누르면 메모 작성/수정 화면으로 이동한다.
  2. 날씨와 기분, 메모의 내용을 수정한 후 수정 버튼을 누르면 DB 수정 후 메인 화면에서 확인이 가능
- 메모 삭제
  - Case 1(단일 삭제)
    1. 메인 화면에서 삭제를 원하는 메모를 눌러 나오는 다이얼로그에서 삭제를 누르면 메모가 삭제된다.
  - Case 2(다중 삭제)
    1. 메인 화면의 휴지통 아이콘을 누르면 메모 옆에 체크박스가 뜬다.
    2. 삭제를 원하는 메모를 선택 후 휴지통 아이콘을 누르면 선택한 메모가 삭제된다.
- 메모 검색
  1. 메인 화면 상단의 날짜를 누르면 나오는 다이얼로그에서 From, To 기간을 설정한다.
  2. 적용을 누르면 설정한 기간 내의 메모를 리스트에 표시한다.<br>
  모두 보기를 누르면 전체 메모를 표시하고 취소를 누르면 리스트를 유지한다.
- 통계 보기
  1. 메인 화면의 차트 아이콘을 누르면 나오는 다이얼로그에서 From, To 기간을 설정한다.
  2. 적용을 누르면 설정한 기간 내의 날씨와 기분의 통계를 원형 그래프로 표시한 화면으로 이동한다.<br>
  모두 보기를 누르면 전체 기간의 통계를 보여주고 취소를 누르면 아무것도 하지 않는다.
  3. 원형 그래프를 터치하면 터치한 부분의 이름과 회수를 그래프 중앙에 표시한다.

### 주요 기능(동일)
<img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM0.png"><img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM5.png"><img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM6.png">

- 메모 리스트
  - DB에서 메모 내역을 가져와 어댑터에 넣어서 리스트뷰에 반영
  - 인덱스 위치에 따라 다른 배경색을 적용(파스텔 톤 그라데이션)
  - 삭제 중이 아닐 시 체크박스의 체크를 해제하고 GONE 상태로 변경
  - 메모 선택 시 날씨와 기분, 메모 내역을 표시하는 다이얼로그를 띄움<br>
  구분을 위해 선택한 메모와 동일한 배경색을 적용<br>
  (버튼 - 수정: 수정 화면으로 이동 | 삭제: DB에서 제거 후 리스트에 반영 | 확인: 다이얼로그를 종료)
  - 상단의 기간 터치 시 기간 설정 다이얼로그를 표시<br>
  기간 설정 후 적용을 누르면 설정한 기간 내의 메모만 리스트에 표시
  
<img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM7.png">

- 메모 추가/수정 화면
- 연필 아이콘을 통해 들어온 경우는 추가 기능, 수정 버튼을 통해 들어온 경우는 수정 기능으로 동작<br>
  추가인 경우 초기 설정 값과 추가 버튼, 수정인 경우 해당 메모의 값과 수정 버튼
  - 날씨와 기분 리스트를 어댑터에 넣어 스피너에 반영
  - 날씨, 기분, 메모 내역 작성 후 하단의 버튼을 누르면 추가(Insert)/수정(Update) 작업 수행 후 메인 화면으로 이동

<img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM1.png"><img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM2.png"><img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM3.png">

- 메모 삭제
  - 휴지통 아이콘 선택 시 삭제 상태로 들어가고 UI를 변경(차트→빈 체크박스|검은 휴지통→회색 휴지통|연필→취소)
  <br>취소 선택 시 아이콘 원상 복귀
  - 삭제 상태인 경우 메모 리스트의 우측에 체크박스를 생성<br>
  하나라도 체크가 되면 회색 휴지통이 빨갛게 변함<br>
  상단의 빈 체크박스 아이콘 선택 시 모든 체크박스를 체크 상태로 전환 후 체크된 체크박스 아이콘으로 변경<br>
  체크박스를 수동으로 모구 체크해도 동일하며 하나라도 체크해제 시 빈 체크박스 아이콘으로 변경
  - 빨간색으로 바뀐 휴지통 선택 시 체크된 메모들을 DB에서 삭제 후 리스트뷰를 업데이트<br>
  메모를 선택해서 뜨는 다이얼로그의 삭제 버튼을 누르면 해당 메모에 대해 동일 작업을 수행
  
<img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM4.png"><img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM8.png"><img src="https://github.com/zxc3824/17.2.2-DM/blob/master/etc/DM9.png">

- 날씨, 기분 통계
  - 차트 아이콘 선택 시 기간 설정 다이얼로그를 표시<br>
  기간 설정 후 적용을 누르면 설정한 기간에 해당하는 날씨와 기분의 개수를 DB에서 가져온 통계 화면에 전달
  - 받아온 개수 리스트로 날씨 통계 그래프와 기분 통계 그래프를 생성<br>
  그래프의 영역 터치 시 확대되며 그래프 중앙에 이름과 회수를 표시

### 변경점
- ListView에서 RecyclerView로 변경
- 체크 기능을 레이아웃 부분이 아닌 어댑터에서 처리 및 관리
- DB 생성/버전 관리 클래스와 DB 조작 클래스를 한 파일에서 관리

### 겪었던 문제(기술)
- 멤버 변수 선언 후 나중에 초기화가 안 됨
  - 코틀린에서는 기본적으로 초기화를 선언부에서 해야 함
  - var는 lateinit 접두사를 써서 나중에 초기화가 가능하게 하고<br>
  val은 lazy 확장 함수의 람다식에 초기화 내용을 넣어 해당 변수 사용시에 초기화가 진행되도록 해서 해결
- 리사이클러뷰에는 커서를 담는 어댑터가 존재하지 않음
  - 어댑터에 커서를 넣어도 각 뷰의 위치를 알 수 없음
  - 여러 시도 이후 깃허브의 CursorRecyclerViewAdapter 클래스를 사용하는 것으로 해결
- 리사이클러뷰에는 onItemClickListener가 존재하지 않음
  - onItemClickListener가 없어서 체크박스 연동이 안되고 메모 다이얼로그도 나타나지 않음
  - 여러 시도 끝에 ViewHolder에서 객체를 초기화할 때 이벤트 리스너를 정의하는 것으로 해결
- 리사이클러뷰에 체크박스 자체 지원 기능이 없음
  - 여러 시도 끝에 어댑터에 체크박스 조작 및 관리 기능을 추가하는 것으로 해결
- 안쪽 클래스에서 바깥쪽 클래스의 속성과 메소드에 접근이 안 됨
  - 알고보니 그냥 선언한 클래스는 Nested 클래스라고 부르며 바깥 클래스와는 관계없는 클래스로 취급이 되었음
  - inner class로 선언하여 기존의 Java에서 쓰는 방식대로 사용하는 것으로 해결

---

### 잡담 및 소감
- 코틀린을 배우기 위한 목적으로 한 번 기존 프로젝트를 다시 만들어봤는데<br>
예상은 했지만 그래도 엄청나게 효율적이었다.<br>
변수를 자동적으로 캡슐화해주면서도 사용은 일반 변수처럼 사용하고<br>
안드로이드 지원 기능으로 R.drawable.id 같은 형태에서 id로 바로 부를 수도 있고<br>
람다식도 SAM 규칙을 통해 간단하게 정의할 수 있었고<br>
특히 일부는 다른 곳으로 옮겼다지만 onCreate 함수에 추가한 게 5줄밖에 없다는게 참 굉장했다.<br>
아마 앞으로도 자바보다는 코틀린을 사용하지 싶다.<br><br>
하지만 그거랑은 별도로 언어만 바꿔서 만든 건데 의외로 오래 걸렸는데<br>
ListView가 안드로이드 스튜디오의 UI 팔레트에서 사라지고 RecyclerVIew를 권장하길래 바꾸려 했더니<br>
기본 구조가 리스트뷰랑은 상당히 다르고, 무엇보다 상당수를 커스텀에 의존하기에 이해가 힘들었다.<br>
게다가 코틀린이 딱히 써본 적도 없는 ?,!,!!도 사용하고 자바랑 달리 변수가 기본 null 불허라 문제가 많았다.<br>
어떻게든 맞추려고 노력하느라 시간이 많이 걸렸던 것 같다.<br>
중간에 포기할까도 생각했었는데 어떻게든 성공해서 다행이라 생각한다.<br>
배우는 도중에 더 좋게 만들 수 있는 부분이 있으면 개선을 해봐야겠다.
